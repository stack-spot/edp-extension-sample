{"version":3,"file":"util.js","sources":["../src/util.ts"],"sourcesContent":["type Encoders = Array<(s: string) => string>;\n\n// Encode param names and values as URIComponent\nexport const encodeReserved = [encodeURIComponent, encodeURIComponent];\nexport const allowReserved = [encodeURIComponent, encodeURI];\n\n/**\n * Creates a tag-function to encode template strings with the given encoders.\n */\nexport function encode(encoders: Encoders, delimiter = \",\") {\n  const q = (v: any, i: number) => {\n    const encoder = encoders[i % encoders.length];\n    if (typeof v === \"undefined\") {\n      return \"\";\n    }\n    if (typeof v === \"object\") {\n      if (Array.isArray(v)) {\n        return v.map(encoder).join(delimiter);\n      }\n      const flat = Object.entries(v).reduce(\n        (flat, entry) => [...flat, ...entry],\n        [] as any,\n      );\n      return flat.map(encoder).join(delimiter);\n    }\n\n    return encoder(String(v));\n  };\n\n  return (strings: TemplateStringsArray, ...values: any[]) => {\n    return strings.reduce((prev, s, i) => {\n      return `${prev}${s}${q(values[i], i)}`;\n    }, \"\");\n  };\n}\n\n/**\n * Separate array values by the given delimiter.\n */\nexport function delimited(delimiter = \",\") {\n  return (params: Record<string, any>, encoders = encodeReserved) =>\n    Object.entries(params)\n      .filter(([, value]) => value !== undefined)\n      .map(([name, value]) => encode(encoders, delimiter)`${name}=${value}`)\n      .join(\"&\");\n}\n\nexport function joinUrl(...parts: Array<string | undefined>) {\n  return parts\n    .filter(Boolean)\n    .map((s, i) => (i === 0 ? s : s!.replace(/^\\/+/, \"\")))\n    .map((s, i, a) => (i === a.length - 1 ? s : s!.replace(/\\/+$/, \"\")))\n    .join(\"/\");\n}\n"],"names":["encodeReserved","allowReserved","encode","encoders","delimiter","q","v","i","encoder","flat","entry","strings","values","prev","s","delimited","params","value","name","joinUrl","parts","a"],"mappings":"AAGa,MAAAA,IAAiB,CAAC,oBAAoB,kBAAkB,GACxDC,IAAgB,CAAC,oBAAoB,SAAS;AAK3C,SAAAC,EAAOC,GAAoBC,IAAY,KAAK;AACpD,QAAAC,IAAI,CAACC,GAAQC,MAAc;AAC/B,UAAMC,IAAUL,EAASI,IAAIJ,EAAS,MAAM;AACxC,WAAA,OAAOG,IAAM,MACR,KAEL,OAAOA,KAAM,WACX,MAAM,QAAQA,CAAC,IACVA,EAAE,IAAIE,CAAO,EAAE,KAAKJ,CAAS,IAEzB,OAAO,QAAQE,CAAC,EAAE;AAAA,MAC7B,CAACG,GAAMC,MAAU,CAAC,GAAGD,GAAM,GAAGC,CAAK;AAAA,MACnC,CAAC;AAAA,IAAA,EAES,IAAIF,CAAO,EAAE,KAAKJ,CAAS,IAGlCI,EAAQ,OAAOF,CAAC,CAAC;AAAA,EAAA;AAGnB,SAAA,CAACK,MAAkCC,MACjCD,EAAQ,OAAO,CAACE,GAAMC,GAAG,MACvB,GAAGD,CAAI,GAAGC,CAAC,GAAGT,EAAEO,EAAO,CAAC,GAAG,CAAC,CAAC,IACnC,EAAE;AAET;AAKgB,SAAAG,EAAUX,IAAY,KAAK;AACzC,SAAO,CAACY,GAA6Bb,IAAWH,MAC9C,OAAO,QAAQgB,CAAM,EAClB,OAAO,CAAC,CAAA,EAAGC,CAAK,MAAMA,MAAU,MAAS,EACzC,IAAI,CAAC,CAACC,GAAMD,CAAK,MAAMf,EAAOC,GAAUC,CAAS,IAAIc,CAAI,IAAID,CAAK,EAAE,EACpE,KAAK,GAAG;AACf;AAEO,SAASE,KAAWC,GAAkC;AAC3D,SAAOA,EACJ,OAAO,OAAO,EACd,IAAI,CAACN,GAAGP,MAAOA,MAAM,IAAIO,IAAIA,EAAG,QAAQ,QAAQ,EAAE,CAAE,EACpD,IAAI,CAACA,GAAGP,GAAGc,MAAOd,MAAMc,EAAE,SAAS,IAAIP,IAAIA,EAAG,QAAQ,QAAQ,EAAE,CAAE,EAClE,KAAK,GAAG;AACb;"}