import { permissionClient } from './network/PermissionClient'
import { Config, ConfigInput } from './types'

const USER_KEY = '@stack-spot/opa:user'

export const config: Config = {}

export function setup({ url, session, apiMap, verbose }: ConfigInput) {
  config.url = url
  config.session = session
  config.apiMap = apiMap
  config.verbose = verbose
  const prevUserId = localStorage.getItem(USER_KEY)
  const userId = session.getTokenData().account_id_v2 ?? ''
  localStorage.setItem(USER_KEY, userId)
  if (prevUserId !== userId) {
    permissionClient.invalidateCache()
  }
}
