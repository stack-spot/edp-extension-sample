import { HttpError } from '@oazapfts/runtime'
import { defaults, runRollbackApp2, runRollbackInfra2 } from '../api/apiRuntime'
import apis from '../apis.json'
import { DefaultAPIError } from '../error/DefaultAPIError'
import { rteDictionary } from '../error/dictionary/rte'
import { StackspotAPIError } from '../error/StackspotAPIError'
import { ReactQueryNetworkClient } from '../network/ReactQueryNetworkClient'

class RuntimeManagerClient extends ReactQueryNetworkClient {
  constructor() {
    super(apis.apiRuntime.url, defaults)
  }

  protected buildStackSpotError(error: HttpError): StackspotAPIError {
    return new DefaultAPIError(error.data, error.status, rteDictionary, error.headers)
  }

  /**
   * Runs an app rollback
   */
  appRollback = this.mutation(runRollbackApp2)
 
  /**
   * Runs an infra rollback
   */
  infraRollback = this.mutation(runRollbackInfra2)
}

export const runtimeManagerClient = new RuntimeManagerClient()
