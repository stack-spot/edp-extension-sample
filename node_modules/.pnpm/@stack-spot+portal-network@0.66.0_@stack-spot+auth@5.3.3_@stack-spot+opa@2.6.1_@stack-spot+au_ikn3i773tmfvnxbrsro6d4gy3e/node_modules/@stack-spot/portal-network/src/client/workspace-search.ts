import { HttpError } from '@oazapfts/runtime'
import { clearUserHistory, defaults, deleteUserHistoryItem, getUserHistory, search } from '../api/workspaceSearchEngine'
import apis from '../apis.json'
import { DefaultAPIError } from '../error/DefaultAPIError'
import { baseDictionary } from '../error/dictionary/base'
import { StackspotAPIError } from '../error/StackspotAPIError'
import { ReactQueryNetworkClient } from '../network/ReactQueryNetworkClient'

class WorkspaceSearchClient extends ReactQueryNetworkClient {
  constructor() {
    super(apis.workspaceSearchEngine.url, defaults)
  }

  protected buildStackSpotError(error: HttpError): StackspotAPIError {
    return new DefaultAPIError(error.data, error.status, baseDictionary, error.headers)
  }

  /**
   * Gets search history
   */
  searchHistory = this.query(getUserHistory)
 
  /**
   * Gets search data
   */
  search = this.infiniteQuery(search, { accumulator: 'content', initialPageParam: 0 })

  /**
   * Clears users history
   */
  clearAllUserHistory = this.mutation(clearUserHistory)
  
  /**
   * Clears a specific entry in users history
   */
  clearEntryInUserHistory = this.mutation(deleteUserHistoryItem)
}

export const workspaceSearchClient = new WorkspaceSearchClient()
