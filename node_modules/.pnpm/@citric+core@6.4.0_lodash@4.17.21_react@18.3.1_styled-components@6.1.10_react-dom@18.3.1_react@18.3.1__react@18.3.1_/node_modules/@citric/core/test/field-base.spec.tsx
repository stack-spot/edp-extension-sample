import 'jest-styled-components'
import { styled } from 'styled-components'
import defaultTheme from '../src/default-theme'
import { FieldProps, getFieldBaseStyle } from '../src/field-base'
import { OneOfColorSchemes } from '../src/theme-types'
import { render } from './react'

const colorSchemes = Object.keys(defaultTheme.colorScheme) as OneOfColorSchemes[]

const FooComponent = styled.input<FieldProps>`
  ${({ colorScheme }) => getFieldBaseStyle(defaultTheme, colorScheme)}
`

test('should render a component using getFieldBaseStyle', () => {
  const { container } = render(<FooComponent />)

  expect(container.firstChild).toMatchInlineSnapshot(`
.c0 {
  width: 100%;
  height: 2.5rem;
  padding: 0.5rem;
  outline: none;
  box-sizing: border-box;
  background-color: #14141A;
  border: 1px solid #2F2F3C;
  border-radius: 0.25rem;
  font: 400 0.875rem/1.714 Roboto,sans-serif;
  color: #FAFAFB;
}

.c0::placeholder {
  opacity: 60%;
  color: #FAFAFB;
}

.c0:focus {
  border-color: #FF6633;
  box-shadow: inset 0 0 0 1px #FF6633;
}

.c0:disabled {
  background-color: #262631;
  border-color: #2F2F3C;
  cursor: not-allowed;
}

.c0:-webkit-autofill,
.c0:-webkit-autofill:hover,
.c0:-webkit-autofill:focus {
  -webkit-text-fill-color: #FAFAFB;
  box-shadow: inset 0 0 0 1000px #14141A;
  transition: background-color 50000s ease-in-out 0s;
}

<input
  class="c0"
/>
`)
})

test('should render a component using getFieldBaseStyle with disabled parameter', () => {
  const { container } = render(<FooComponent disabled />)

  expect(container.firstChild).toHaveAttribute('disabled')
})

test('should render a component using getFieldBaseStyle with autofocus parameter', () => {
  const { container } = render(<FooComponent autoFocus />)
  const colorScheme = defaultTheme.colorScheme.primary

  expect(container.firstChild).toHaveFocus()

  expect(container.firstChild).toHaveStyleRule('border-color', `${colorScheme['500']}`, {
    modifier: ':focus',
  })

  expect(container.firstChild).toHaveStyleRule(
    'box-shadow',
    `inset 0 0 0 1px ${colorScheme['500']}`,
    {
      modifier: ':focus',
    },
  )
})

describe('ColorScheme parameter', () => {
  it.each(colorSchemes)('as %s', (colorSchemeName) => {
    const { container } = render(<FooComponent colorScheme={colorSchemeName} />)
    const colorScheme = defaultTheme.colorScheme[colorSchemeName]

    expect(container.firstChild).toHaveStyleRule('border', `1px solid ${colorScheme['500']}`)
  })
})
