import { ThirdPartyLoginParams } from '@stack-spot/auth'
import { getCookie, getCookieDomain, removeCookie, setCookie } from '@stack-spot/portal-components'

const sessionKey = `stk-session${getCookieDomain()}`

type SessionCookie = ThirdPartyLoginParams & { sub: string, tenant: string }

export const sessionCookie = Object.freeze({
  set: (data: SessionCookie) => setCookie(sessionKey, JSON.stringify(data)),
  get: (): SessionCookie | undefined => {
    try {
      const cookie = getCookie(sessionKey)
      return cookie ? JSON.parse(cookie) : undefined
    } catch (error) {
      console.error(error)
    }
  },
  delete: () => removeCookie(sessionKey)
})
